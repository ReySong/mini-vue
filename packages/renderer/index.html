<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>renderer</title>
    </head>

    <body>
        <div id="app"></div>
        <script type="module">
            import { renderer, Fragment, onMounted, defineAsyncComponent } from "./index.js";

            function fetch() {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        reject("err");
                    }, 1000);
                });
            }

            const MyComponent = {
                name: "MyComponent",
                setup() {
                    return () => {
                        return {
                            type: "div",
                            children: "This is async component",
                        };
                    };
                },
            };

            const LoadingComponent = {
                name: "LoadingComponent",
                setup() {
                    return () => {
                        return {
                            type: "div",
                            children: "This is loading component",
                        };
                    };
                },
            };

            const AsyncComponent = defineAsyncComponent({
                loader: () => {
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            reject("err");
                        }, 1000);
                    });
                },
                onError: (retry, fail, retries) => {
                    if (retries <= 3) {
                        retry();
                        console.log(retries);
                    } else {
                        fail();
                    }
                },
                delay: 1000,
                loadingComponent: LoadingComponent,
            });

            const CompVNode = {
                type: AsyncComponent,
            };

            const app = document.querySelector("#app");
            renderer.render(CompVNode, app);
        </script>
    </body>
</html>
